IF DB_ID('FashionWeb') IS NOT NULL
    DROP DATABASE FashionWeb;
GO
CREATE DATABASE FashionWeb;
GO
USE FashionWeb;
GO

-- ============================
-- 1. CUSTOMER
-- ============================
CREATE TABLE CUSTOMER (
    KHACHHANGID NCHAR(10) NOT NULL,
    HOTEN NVARCHAR(100) NOT NULL,
    NGAYSINH DATE NULL,
    EMAIL NVARCHAR(100) NOT NULL,
    PASSWORD NVARCHAR(60) NOT NULL,
    DIENTHOAI VARCHAR(15) NULL,
    CONSTRAINT PK_CUSTOMER PRIMARY KEY (KHACHHANGID),
    CONSTRAINT UQ_CUSTOMER_EMAIL UNIQUE (EMAIL),
    CONSTRAINT UQ_CUSTOMER_PHONE UNIQUE (DIENTHOAI)
);
GO

-- ============================
-- 2. ADDRESS
-- ============================
CREATE TABLE ADDRESS (
    DIACHIID NCHAR(10) NOT NULL,
    KHACHHANGID NCHAR(10) NOT NULL,
    DUONG NVARCHAR(200) NULL,
    THANHPHO NVARCHAR(100) NULL,
    TINH NVARCHAR(100) NULL,
    ZIPCODE VARCHAR(10) NULL,
    CONSTRAINT PK_ADDRESS PRIMARY KEY (DIACHIID),
    CONSTRAINT FK_ADDRESS_CUSTOMER FOREIGN KEY (KHACHHANGID) REFERENCES CUSTOMER(KHACHHANGID)
);
GO

-- ============================
-- 3. CATEGORY
-- ============================
CREATE TABLE CATEGORY (
    DANHMUCID NCHAR(10) NOT NULL,
    TENDANHMUC NVARCHAR(100) NOT NULL,
    CONSTRAINT PK_CATEGORY PRIMARY KEY (DANHMUCID),
    CONSTRAINT UQ_CATEGORY_NAME UNIQUE (TENDANHMUC)
);
GO

-- ============================
-- 4. PRODUCT 
-- ============================
CREATE TABLE PRODUCT (
    SANPHAMID NCHAR(10) NOT NULL,
    TENSANPHAM NVARCHAR(200) NOT NULL,
    DANHMUCID NCHAR(10) NOT NULL,
    GIAGOC DECIMAL(18,2) NOT NULL,         -- Giá gốc của sản phẩm
    GIA DECIMAL(18,2) NOT NULL,            -- Giá đã giảm (giá hiển thị)
    SOLUONGTONKHO INT NOT NULL,
    MOTA NVARCHAR(MAX) NULL,
    HINHANHDAIDIEN NVARCHAR(255) NULL,   -- Ảnh đại diện
    CONSTRAINT PK_PRODUCT PRIMARY KEY (SANPHAMID),
    CONSTRAINT FK_PRODUCT_CATEGORY FOREIGN KEY (DANHMUCID) REFERENCES CATEGORY(DANHMUCID),
    CONSTRAINT CK_PRODUCT_PRICE_FIRST CHECK (GIAGOC > 0),
    CONSTRAINT CK_PRODUCT_PRICE CHECK (GIA > 0),
    CONSTRAINT CK_PRODUCT_STOCK CHECK (SOLUONGTONKHO >= 0)
);
GO

-- ============================
-- 5. PRODUCT_SIZE
-- ============================
CREATE TABLE PRODUCT_SIZE (
    SANPHAMID NCHAR(10) NOT NULL,
    SIZE NVARCHAR(10) NOT NULL,
    CONSTRAINT PK_PRODUCT_SIZE PRIMARY KEY (SANPHAMID, SIZE),
    CONSTRAINT FK_PRODUCT_SIZE_PRODUCT FOREIGN KEY (SANPHAMID) REFERENCES PRODUCT(SANPHAMID)
);
GO

-- ============================
-- 6. PRODUCT_COLOR
-- ============================
CREATE TABLE PRODUCT_COLOR (
    SANPHAMID NCHAR(10) NOT NULL,
    MAUSAC NVARCHAR(50) NOT NULL,
    CONSTRAINT PK_PRODUCT_COLOR PRIMARY KEY (SANPHAMID, MAUSAC),
    CONSTRAINT FK_PRODUCT_COLOR_PRODUCT FOREIGN KEY (SANPHAMID) REFERENCES PRODUCT(SANPHAMID)
);
GO

-- ============================
-- 7. PRODUCT_IMAGE 
-- ============================
CREATE TABLE PRODUCT_IMAGE (
    IMAGEID INT IDENTITY(1,1) PRIMARY KEY,
    SANPHAMID NCHAR(10) NOT NULL,
    MAUSAC NVARCHAR(50) NULL, -- ảnh có thể gắn theo màu (VD: đỏ, xanh)
    TENHINH NVARCHAR(255) NOT NULL, -- đường dẫn hoặc tên file ảnh
    CONSTRAINT FK_PRODUCT_IMAGE_PRODUCT FOREIGN KEY (SANPHAMID) REFERENCES PRODUCT(SANPHAMID)
);
GO

-- ============================
-- 8. STAFF  
-- ============================
CREATE TABLE STAFF (
    MANV NCHAR(10) NOT NULL,
    HOTEN NVARCHAR(100) NOT NULL,
    GIOITINH NVARCHAR(10) NULL,
    NGAYSINH DATE NULL,
    DIACHI NVARCHAR(200) NULL,
    DIENTHOAI VARCHAR(15) NULL,
    EMAIL NVARCHAR(100) NULL,
    PASSWORD NVARCHAR(60) NOT NULL,       -- 🔒 Mật khẩu đăng nhập
    CHUCVU NVARCHAR(50) NULL,
    LUONG DECIMAL(18,2) NULL,
    NGAYVAOLAM DATE DEFAULT GETDATE(),
    CONSTRAINT PK_NHANVIEN PRIMARY KEY (MANV),
    CONSTRAINT UQ_NHANVIEN_EMAIL UNIQUE (EMAIL)
);
GO

-- ============================
-- 9. CART  
-- ============================
CREATE TABLE CART (
    CARTID INT IDENTITY(1,1),
    KHACHHANGID NCHAR(10) NULL,
    MANV NCHAR(10) NULL,
    NGAYTAO DATETIME DEFAULT GETDATE(),
    TRANGTHAI NVARCHAR(50) DEFAULT N'Chưa thanh toán',
    CONSTRAINT PK_CART PRIMARY KEY (CARTID),
    CONSTRAINT FK_CART_CUSTOMER FOREIGN KEY (KHACHHANGID) REFERENCES CUSTOMER(KHACHHANGID),
    CONSTRAINT FK_CART_STAFF FOREIGN KEY (MANV) REFERENCES STAFF(MANV)
);
GO

-- ============================
-- 10. CARTDETAIL 
-- ============================
CREATE TABLE CARTDETAIL (
    CARTDETAILID INT IDENTITY(1,1),
    CARTID INT NOT NULL,
    SANPHAMID NCHAR(10) NOT NULL,
    SOLUONG INT NOT NULL CHECK (SOLUONG > 0),
    CONSTRAINT PK_CARTDETAIL PRIMARY KEY (CARTDETAILID),
    CONSTRAINT FK_CARTDETAIL_CART FOREIGN KEY (CARTID) REFERENCES CART(CARTID),
    CONSTRAINT FK_CARTDETAIL_SANPHAM FOREIGN KEY (SANPHAMID) REFERENCES PRODUCT(SANPHAMID)
);
GO

-- ============================
-- 11. ORDERS 
-- ============================
CREATE TABLE ORDERS (
    ORDERID NCHAR(10) NOT NULL,
    KHACHHANGID NCHAR(10) NOT NULL,
    DIACHIID NCHAR(10) NOT NULL,
    NGAYDAT DATE NOT NULL,
    TONGTIEN DECIMAL(18,2) NOT NULL,
    TRANGTHAI NVARCHAR(50) NOT NULL,
    GHICHU NVARCHAR(500) NULL,
    MANV_XULY NCHAR(10) NULL,
    CONSTRAINT PK_ORDERS PRIMARY KEY (ORDERID),
    CONSTRAINT FK_ORDERS_CUSTOMER FOREIGN KEY (KHACHHANGID) REFERENCES CUSTOMER(KHACHHANGID),
    CONSTRAINT FK_ORDERS_ADDRESS FOREIGN KEY (DIACHIID) REFERENCES ADDRESS(DIACHIID),
    CONSTRAINT FK_ORDERS_STAFF FOREIGN KEY (MANV_XULY) REFERENCES STAFF(MANV)
);
GO

-- ============================
-- 12. ORDERDETAIL
-- ============================
CREATE TABLE ORDERDETAIL (
    ORDERID NCHAR(10) NOT NULL,
    SANPHAMID NCHAR(10) NOT NULL,
    SOLUONG INT NOT NULL,
    DONGIA DECIMAL(18,2) NOT NULL,
    THANHTIEN AS (SOLUONG * DONGIA) PERSISTED,
    CONSTRAINT PK_ORDERDETAIL PRIMARY KEY (ORDERID, SANPHAMID),
    CONSTRAINT FK_ORDERDETAIL_ORDERS FOREIGN KEY (ORDERID) REFERENCES ORDERS(ORDERID),
    CONSTRAINT FK_ORDERDETAIL_PRODUCT FOREIGN KEY (SANPHAMID) REFERENCES PRODUCT(SANPHAMID),
    CONSTRAINT CK_ORDERDETAIL_QTY CHECK (SOLUONG > 0),
    CONSTRAINT CK_ORDERDETAIL_PRICE CHECK (DONGIA > 0)
);
GO

-- ============================
-- 13. PAYMENT
-- ============================
CREATE TABLE PAYMENT (
    PAYMENTID NCHAR(10) NOT NULL,
    ORDERID NCHAR(10) NOT NULL,
    PHUONGTHUCTT NVARCHAR(50) NOT NULL,
    TRANGTHAITT NVARCHAR(50) NOT NULL,
    NGAYTT DATE NULL,
    CONSTRAINT PK_PAYMENT PRIMARY KEY (PAYMENTID),
    CONSTRAINT FK_PAYMENT_ORDER FOREIGN KEY (ORDERID) REFERENCES ORDERS(ORDERID)
);
GO

-- ==========================================
-- XÓA TOÀN BỘ BẢNG TRONG FashionWeb 
-- ==========================================
IF OBJECT_ID('ORDERDETAIL', 'U') IS NOT NULL DROP TABLE ORDERDETAIL;
IF OBJECT_ID('PAYMENT', 'U') IS NOT NULL DROP TABLE PAYMENT;
IF OBJECT_ID('ORDERS', 'U') IS NOT NULL DROP TABLE ORDERS;
IF OBJECT_ID('CARTDETAIL', 'U') IS NOT NULL DROP TABLE CARTDETAIL;
IF OBJECT_ID('CART', 'U') IS NOT NULL DROP TABLE CART;
IF OBJECT_ID('PRODUCT_IMAGE', 'U') IS NOT NULL DROP TABLE PRODUCT_IMAGE;
IF OBJECT_ID('PRODUCT_COLOR', 'U') IS NOT NULL DROP TABLE PRODUCT_COLOR;
IF OBJECT_ID('PRODUCT_SIZE', 'U') IS NOT NULL DROP TABLE PRODUCT_SIZE;
IF OBJECT_ID('PRODUCT', 'U') IS NOT NULL DROP TABLE PRODUCT;
IF OBJECT_ID('CATEGORY', 'U') IS NOT NULL DROP TABLE CATEGORY;
IF OBJECT_ID('ADDRESS', 'U') IS NOT NULL DROP TABLE ADDRESS;
IF OBJECT_ID('CUSTOMER', 'U') IS NOT NULL DROP TABLE CUSTOMER;
IF OBJECT_ID('STAFF', 'U') IS NOT NULL DROP TABLE STAFF;
GO


-- ============ PART 1: CATEGORY & PRODUCT ============

-- Categories
INSERT INTO CATEGORY (DANHMUCID, TENDANHMUC) VALUES ('DM001', N'Áo');
INSERT INTO CATEGORY (DANHMUCID, TENDANHMUC) VALUES ('DM002', N'Quần');
INSERT INTO CATEGORY (DANHMUCID, TENDANHMUC) VALUES ('DM003', N'Phụ kiện');

-- Products (30 sản phẩm theo file)
INSERT INTO PRODUCT (SANPHAMID, TENSANPHAM, DANHMUCID, GIAGOC, GIA, SOLUONGTONKHO, MOTA, HINHANHDAIDIEN) VALUES
('SP001', N'/solid / Big Logo Mask', 'DM003', 70000.00, 21000.00, 35, N'Khẩu trang thời trang, thoáng khí, phù hợp sử dụng hằng ngày.', 'public/3.jpeg'),
('SP002', N'/solid / Big Logo Mask', 'DM003', 70000.00, 21000.00, 40, N'Khẩu trang thời trang, thoáng khí, phù hợp sử dụng hằng ngày.', 'public/3.jpeg'),
('SP003', N'/stroke/ BIG LOGO FLANNEL SHIRT™', 'DM001', 470000.00, 175000.00, 25, N'Áo sơ mi sọc có thể dùng như áo khoác, vải mềm, phong cách flannel.', 'public/Vj3rWMX.jpeg'),
('SP004', N'/two-tone line/ Big Logo Mask', 'DM003', 70000.00, 21000.00, 30, N'Khẩu trang thời trang, thiết kế two-tone.', 'public/hwTs3US.jpeg'),
('SP005', N'/T-shirt/ Blacksheeps', 'DM001', 390000.00, 250000.00, 28, N'Áo thun in thương hiệu Blacksheeps, chất cotton thoáng mát.', 'public/7KT4nnr.png'),
('SP006', N'BLACKSHEEPS POLO SS TEE', 'DM001', 390000.00, 195000.00, 32, N'Áo polo Blacksheeps, phong cách casual.', 'public/pUcOAao.png'),
('SP007', N'/trademark™/ CARGO PANTS', 'DM002', 550000.00, 95000.00, 20, N'Quần cargo nhiều túi, phong cách utility.', 'thumbnail/cargo1.jpeg'),
('SP008', N'/T-shirt/ Checker Board', 'DM001', 333000.00, 195000.00, 30, N'Áo thun họa tiết bàn cờ, form rộng thoải mái.', 'public/2p9OYYL.jpeg'),
('SP009', N'/teddy bear/ CROP TEE', 'DM001', 270000.00, 99000.00, 22, N'Áo crop tee in hình teddy bear, phong cách trẻ trung.', 'public/tbjmHcb.png'),
('SP010', N'/over/ Corduroy Dad Cap', 'DM003', 390000.00, 151000.00, 18, N'Nón kết corduroy phong cách Dad Cap.', 'public/YcmDCv9.jpeg'),
('SP011', N'SHEEPMAN HAT PANEL 6', 'DM003', 390000.00, 151000.00, 15, N'Nón panel 6, thiết kế đơn giản.', 'public/0hZe7KE.png'),
('SP012', N'/sketch/ Embroider Traditional Fit Hoodie', 'DM001', 590000.00, 390000.00, 26, N'Hoodie thêu truyền thống, vải dày ấm.', 'public/jYP98si.png'),
('SP013', N'/floral youth/ KAKI JACKET', 'DM001', 490000.00, 233000.00, 20, N'Áo khoác kaki, phong cách trẻ trung.', 'public/h60x6UW.png'),
('SP014', N'Letter Mask', 'DM003', 70000.00, 21000.00, 40, N'Khẩu trang Letter Mask, thoáng khí.', 'public/2.jpeg'),
('SP015', N'/solid/ Letter Logo Mask', 'DM003', 70000.00, 21000.00, 38, N'Khẩu trang Letter Logo, nhiều màu lựa chọn.', 'public/XsIqeyw.jpeg'),
('SP016', N'/PUBLIC ICON/ LONG WALLET', 'DM003', 100000.00, 50000.00, 14, N'Ví dài PUBLIC ICON, nhiều ngăn tiện dụng.', 'public/main.jpg'),
('SP017', N'BlackSheeps Mini Shoulder Bag', 'DM003', 250000.00, 195000.00, 16, N'Túi đeo chéo nhỏ BlackSheeps, tiện dụng hàng ngày.', 'thumbnail/minigab_black.png'),
('SP018', N'5THEWAY® 학교 PEN POUCH™', 'DM003', 100000.00, 50000.00, 20, N'Ví đựng bút phong cách 5THEWAY®, tiện lợi.', 'public/4.jpeg'),
('SP019', N'RELAXED TAPERED PANTS', 'DM002', 490000.00, 181000.00, 24, N'Quần tây dáng relaxed tapered, vải mềm.', 'public/eGW9p85.jpeg'),
('SP020', N'/solid/ Rocket Backpack', 'DM003', 750000.00, 471000.00, 12, N'Balo Rocket, nhiều ngăn, bền chắc.', 'public/B4cFp4A.jpeg'),
('SP021', N'/plastic/ ROCKET BACKPACK', 'DM003', 610000.00, 300000.00, 14, N'Balo ROCKET chất liệu plastic chống nước.', 'public/UOhS20W.png'),
('SP022', N'SHEEPSMAN FACE MASK', 'DM003', 70000.00, 21000.00, 45, N'Khẩu trang SHEEPSMAN, chất liệu co giãn.', 'public/F1Tqkq3.png'),
('SP023', N'SHEEPSMAN FACE HOODIE', 'DM001', 650000.00, 275000.00, 18, N'Hoodie SHEEPSMAN mặt in lớn, ấm áp.', 'public/UZ4JuK5.png'),
('SP024', N'SHEEPSMAN FACE KAKI JACKET', 'DM001', 550000.00, 251000.00, 20, N'Kaki jacket SHEEPSMAN, form chuẩn.', 'public/kKXp1W9.jpeg'),
('SP025', N'SPACE JAM SS TEE', 'DM001', 290000.00, 150000.00, 22, N'Áo Space Jam, họa tiết nổi bật.', 'thumbnail/spacejam.png'),
('SP026', N'/YILAC/ SQUARE LONG SLEEVE TEE', 'DM001', 350000.00, 250000.00, 19, N'Áo tay dài form rộng, chất dày nhẹ.', 'public/vqMnJ23.png'),
('SP027', N'LED SIGN /teddy bear/ NEW TEE™', 'DM001', 290000.00, 99000.00, 30, N'Áo thun teddy bear, nhiều màu.', 'public/main1.jpg'),
('SP028', N'학교 VARSITY TONE ROCKET BACKPACK™', 'DM003', 550000.00, 470000.00, 10, N'Balo varsity tone, chất liệu cao cấp.', 'public/H6HJdSJ.jpeg'),
('SP029', N'/milky way/ Vertical Drop Shoulder Tee™', 'DM001', 290000.00, 150000.00, 26, N'Áo thun milky way, form oversized.', 'public/apFsKUV.jpeg'),
('SP030', N'/sketch/ Embroider Traditional Fit Hoodie', 'DM001', 450000.00, 333000.00, 16, N'Hoodie thêu kiểu sketch, ấm và thời trang.', 'public/0823f2bf88204b8d829c6c67721a0922.jpg');


-- ============ PART 2: PRODUCT_SIZE ============

-- SP001 (khẩu trang) -> Free size
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP001', N'Free size');
-- SP002 (khẩu trang)
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP002', N'Free size');
-- SP003 sizes: M, L, XL, XXL
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP003', N'M');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP003', N'L');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP003', N'XL');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP003', N'XXL');
-- SP004 Free size
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP004', N'Free size');
-- SP005 sizes: M, L
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP005', N'M');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP005', N'L');
-- SP006 sizes: M, L, XL, XXL
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP006', N'M');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP006', N'L');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP006', N'XL');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP006', N'XXL');
-- SP007 sizes: M, L, XL
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP007', N'M');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP007', N'L');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP007', N'XL');
-- SP008 sizes: S, M, L
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP008', N'S');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP008', N'M');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP008', N'L');
-- SP009 sizes: S, M
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP009', N'S');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP009', N'M');
-- SP010 Free size
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP010', N'Free size');
-- SP011 Free size
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP011', N'Free size');
-- SP012 sizes: M, L, XL
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP012', N'M');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP012', N'L');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP012', N'XL');
-- SP013 sizes: M, L, XL
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP013', N'M');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP013', N'L');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP013', N'XL');
-- SP014 Free size
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP014', N'Free size');
-- SP015 Free size
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP015', N'Free size');
-- SP016 Free size
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP016', N'Free size');
-- SP017 Free size
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP017', N'Free size');
-- SP018 Free size
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP018', N'Free size');
-- SP019 sizes: M, L, XL
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP019', N'M');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP019', N'L');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP019', N'XL');
-- SP020 Free size
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP020', N'Free size');
-- SP021 Free size
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP021', N'Free size');
-- SP022 Free size
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP022', N'Free size');
-- SP023 sizes: M, L, XL
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP023', N'M');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP023', N'L');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP023', N'XL');
-- SP024 sizes: M, L, XL
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP024', N'M');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP024', N'L');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP024', N'XL');
-- SP025 sizes: M, L, XL
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP025', N'M');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP025', N'L');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP025', N'XL');
-- SP026 sizes: M, L
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP026', N'M');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP026', N'L');
-- SP027 sizes: M, L, XL
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP027', N'M');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP027', N'L');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP027', N'XL');
-- SP028 Free size
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP028', N'Free size');
-- SP029 sizes: S, M, L, XL
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP029', N'S');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP029', N'M');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP029', N'L');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP029', N'XL');
-- SP030 sizes: S, M, L, XL
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP030', N'S');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP030', N'M');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP030', N'L');
INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE) VALUES ('SP030', N'XL');



-- ============ PART 2: PRODUCT_COLOR ============

-- SP001 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP001', N'Black');

-- SP002 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP002', N'Black');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP002', N'White');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP002', N'Blue');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP002', N'Grey');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP002', N'Peach');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP002', N'Pristin');

-- SP003 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP003', N'RE/WH');

-- SP004 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP004', N'White');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP004', N'Reel Water');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP004', N'Black');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP004', N'Greige');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP004', N'Neutral Gray');

-- SP005 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP005', N'Brown');

-- SP006 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP006', N'Black');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP006', N'White');

-- SP007 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP007', N'HIGH RISK RED');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP007', N'SPECTRA YELLOW');

-- SP008 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP008', N'Blue');

-- SP009 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP009', N'Black');

-- SP010 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP010', N'Purple');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP010', N'Hot Pink');

-- SP011 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP011', N'White');

-- SP012 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP012', N'Lemon');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP012', N'Caramel');

-- SP013 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP013', N'Pink');

-- SP014 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP014', N'White');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP014', N'Bitter Sweet');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP014', N'Orange');

-- SP015 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP015', N'Black');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP015', N'Black Mint');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP015', N'White');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP015', N'Warm Sand');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP015', N'Bitter Sweet');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP015', N'Flame');

-- SP016 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP016', N'Hot Pink');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP016', N'Blue Atoll');

-- SP017 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP017', N'Black');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP017', N'Grey');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP017', N'White');

-- SP018 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP018', N'Brown');

-- SP019 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP019', N'Olive');

-- SP020 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP020', N'Burgundy');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP020', N'Grey');

-- SP021 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP021', N'Yellow');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP021', N'Orange');

-- SP022 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP022', N'Black');

-- SP023 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP023', N'Yellow');

-- SP024 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP024', N'Black');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP024', N'Beige');

-- SP025 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP025', N'White');

-- SP026 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP026', N'Pale Peach');

-- SP027 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP027', N'Blue');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP027', N'Yellow');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP027', N'Pink');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP027', N'Green');

-- SP028 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP028', N'STANDFORD GREEN');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP028', N'OXFORD BROWN');

-- SP029 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP029', N'Pink');

-- SP030 colors
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP030', N'Seasame');
INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC) VALUES ('SP030', N'Green');


-- ============ PART 2: PRODUCT_IMAGE ============

-- SP001 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP001', N'Black', 'public/3.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP001', N'Reel Water', 'thumbnail/biglogo_reelwater.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP001', N'Castle Rock', 'thumbnail/biglogo_rock.jpeg');

-- SP002 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP002', N'Black', 'thumbnail/mask_black.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP002', N'White', 'public/9Zp92gi.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP002', N'Blue', 'thumbnail/mask_marine-bluejpeg.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP002', N'Grey', 'thumbnail/mask_grey.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP002', N'Peach', 'thumbnail/mask-peach-bud.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP002', N'Pristin', 'thumbnail/mask-pristin.jpeg');

-- SP003 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP003', N'RE/WH', 'public/Vj3rWMX.jpeg');

-- SP004 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP004', N'White', 'public/hwTs3US.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP004', N'Reel Water', 'thumbnail/biglogo_reelwater.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP004', N'Black', 'thumbnail/biglogo_black.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP004', N'Greige', 'thumbnail/biglogo_greige.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP004', N'Neutral Gray', 'thumbnail/biglogo_neutralgray.jpeg');

-- SP005 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP005', N'Brown', 'public/7KT4nnr.png');

-- SP006 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP006', N'Black', 'public/pUcOAao.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP006', N'White', 'thumbnail/BlacksheepsPoloTee_While1.png');

-- SP007 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP007', N'HIGH RISK RED', 'thumbnail/cargo1.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP007', N'HIGH RISK RED', 'thumbnail/cargo2.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP007', N'SPECTRA YELLOW', 'public/gVrAhx4.jpeg');

-- SP008 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP008', N'Blue', 'public/2p9OYYL.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP008', N'Blue', 'thumbnail/checkboard1.jpeg');

-- SP009 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP009', N'Black', 'public/tbjmHcb.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP009', N'Black', 'thumbnail/croptee1.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP009', N'Black', 'thumbnail/CropTeeModel.png');

-- SP010 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP010', N'Purple', 'public/YcmDCv9.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP010', N'Purple', 'thumbnail/dadcap_purple.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP010', N'Hot Pink', 'thumbnail/dadcap_pink1.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP010', N'Hot Pink', 'thumbnail/dadcap_pink2.png');

-- SP011 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP011', N'White', 'public/0hZe7KE.png');

-- SP012 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP012', N'Lemon', 'public/jYP98si.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP012', N'Lemon', 'thumbnail/Embroider_Traditional_Fit_Hoodie2.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP012', N'Lemon', 'thumbnail/Embroider_Traditional_Fit_Hoodie3.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP012', N'Lemon', 'thumbnail/Embroider_Traditional_Fit_Hoodie4.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP012', N'Lemon', 'thumbnail/Embroider_Traditional_Fit_Hoodie5.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP012', N'Caramel', 'thumbnail/hoodie_caramel_1.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP012', N'Caramel', 'thumbnail/hoodie_caramel_2.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP012', N'Caramel', 'thumbnail/hoodie_caramel_3.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP012', N'Caramel', 'thumbnail/hoodie_caramel_4.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP012', N'Caramel', 'thumbnail/hoodie_caramel_5.png');

-- SP013 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP013', N'Pink', 'public/h60x6UW.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP013', N'Pink', 'thumbnail/Kaki_Jacket_pink.png');

-- SP014 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP014', N'White', 'public/2.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP014', N'Bitter Sweet', 'thumbnail/lettermask_bittersweet.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP014', N'Orange', 'thumbnail/lettermask_flame.jpeg');

-- SP015 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP015', N'Black', 'public/XsIqeyw.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP015', N'Black Mint', 'thumbnail/lettermask_blackmint.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP015', N'White', 'thumbnail/lettermask_white.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP015', N'Warm Sand', 'thumbnail/lettermask_warmsand.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP015', N'Bitter Sweet', 'thumbnail/lettermask_bittersweet.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP015', N'Flame', 'thumbnail/lettermask_flame.jpeg');

-- SP016 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP016', N'Hot Pink', 'public/main.jpg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP016', N'Hot Pink', 'thumbnail/longwallet_pint1.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP016', N'Hot Pink', 'thumbnail/longwallet_pint2.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP016', N'Blue Atoll', 'thumbnail/longwallet2_blue.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP016', N'Blue Atoll', 'thumbnail/longwallet_blue1.jpeg');

-- SP017 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP017', N'Black', 'thumbnail/minigab_black.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP017', N'Black', 'thumbnail/minibag.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP017', N'Grey', 'public/1.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP017', N'White', 'thumbnail/minibag_white.png');

-- SP018 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP018', N'Brown', 'public/4.jpeg');

-- SP019 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP019', N'Olive', 'public/eGW9p85.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP019', N'Olive', 'thumbnail/pants_olive.jpeg');

-- SP020 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP020', N'Burgundy', 'public/B4cFp4A.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP020', N'Burgundy', 'thumbnail/bag_burgundy1.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP020', N'Burgundy', 'thumbnail/bag2_burgundy.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP020', N'Burgundy', 'thumbnail/bag_burgundy3.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP020', N'Grey', 'thumbnail/bag_grey1.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP020', N'Grey', 'thumbnail/baggrey2.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP020', N'Grey', 'thumbnail/baggrey3.jpeg');

-- SP021 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP021', N'Yellow', 'public/UOhS20W.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP021', N'Yellow', 'thumbnail/plasticbag_yellow1.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP021', N'Yellow', 'thumbnail/plasticbag_yellow2.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP021', N'Yellow', 'thumbnail/plasticbag_yellow3.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP021', N'Orange', 'thumbnail/plasticbag_cam1.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP021', N'Orange', 'thumbnail/plasticbag_cam2.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP021', N'Orange', 'thumbnail/plasticbag_cam3.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP021', N'Orange', 'thumbnail/plasticbag_cam4.png');

-- SP022 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP022', N'Black', 'public/F1Tqkq3.png');

-- SP023 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP023', N'Yellow', 'public/UZ4JuK5.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP023', N'Yellow', 'thumbnail/SleepmanFaceHoodie_yellow1.png');

-- SP024 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP024', N'Black', 'public/kKXp1W9.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP024', N'Beige', 'thumbnail/SleepmanFaceKakiJacket.jpeg');

-- SP025 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP025', N'White', 'thumbnail/spacejam.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP025', N'White', 'public/RVXdJCd.png');

-- SP026 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP026', N'Pale Peach', 'public/vqMnJ23.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP026', N'Pale Peach', 'thumbnail/SquareLongSleeveTee2.png');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP026', N'Pale Peach', 'thumbnail/SquareLongSleeveTee3.png');

-- SP027 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP027', N'Blue', 'public/main1.jpg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP027', N'Blue', 'thumbnail/teddybear1.jpg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP027', N'Blue', 'thumbnail/teddybear2.jpg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP027', N'Yellow', 'thumbnail/teddybear_yellow1.jpg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP027', N'Yellow', 'thumbnail/teddybear_yellow2.jpg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP027', N'Pink', 'thumbnail/teddybear_pink1.jpg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP027', N'Pink', 'thumbnail/teddybear_pink2.jpg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP027', N'Green', 'thumbnail/teddybear_green1.jpg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP027', N'Green', 'thumbnail/teddybear_green2.jpg');

-- SP028 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP028', N'STANDFORD GREEN', 'public/H6HJdSJ.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP028', N'STANDFORD GREEN', 'thumbnail/rocket_bag1.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP028', N'STANDFORD GREEN', 'thumbnail/rocket_bag2.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP028', N'STANDFORD GREEN', 'thumbnail/rocket_bag3.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP028', N'OXFORD BROWN', 'thumbnail/rocketbag_brown1.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP028', N'OXFORD BROWN', 'thumbnail/rocketbag_brown2.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP028', N'OXFORD BROWN', 'thumbnail/rocketbag_brown3.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP028', N'OXFORD BROWN', 'thumbnail/rocketbag_brown4.jpeg');

-- SP029 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP029', N'Pink', 'public/apFsKUV.jpeg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP029', N'Pink', 'thumbnail/milky_pink1.jpeg');

-- SP030 images
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP030', N'Seasame', 'public/0823f2bf88204b8d829c6c67721a0922.jpg');
INSERT INTO PRODUCT_IMAGE (SANPHAMID, MAUSAC, TENHINH) VALUES ('SP030', N'Green', 'thumbnail/zigzag_laurielgreen.jpg');


-- ============ PART 3: DỮ LIỆU MẪU CHO CÁC BẢNG KHÁC ============

-- CUSTOMERS (KHACHHANGID NCHAR(10))
INSERT INTO CUSTOMER (KHACHHANGID, HOTEN, NGAYSINH, EMAIL, PASSWORD, DIENTHOAI) VALUES
('KH001', N'Nguyễn Văn A', '1990-05-10', 'nguyenvana@gmail.com', 'pass123', '0901000001'),
('KH002', N'Trần Thị B', '1995-08-20', 'tranthib@gmail.com', 'pass123', '0901000002');

-- STAFF (MANV NCHAR(10))
INSERT INTO STAFF (MANV, HOTEN, GIOITINH, NGAYSINH, DIACHI, DIENTHOAI, EMAIL, PASSWORD, CHUCVU, LUONG)
VALUES
('NV001', N'Nguyễn Hữu Khánh', N'Nam', '2005-09-10', N'Quận 1, TP.HCM', '0902000001', 'admin1@gmail.com', 'admin@123', N'Quản lý', 8000000),
('NV002', N'Nguyễn Vũ Phương Uyên', N'Nữ', '1992-11-05', N'Quận 3, TP.HCM', '0902000002', 'nhanvien1@gmail.com', 'uyen@123', N'Nhân viên bán hàng', 6000000),
('NV003', N'Phan Thị Hồng Hòa', N'Nữ', '1998-09-14', N'456 Nguyễn Trãi, Quận 5, TP.HCM', '0915234987', 'nhanvien2@gmail.com', 'hoa@123', N'Nhân viên bán hàng', 9000000);
GO


-- ADDRESS (DIACHIID NCHAR(10))
INSERT INTO ADDRESS (DIACHIID, KHACHHANGID, DUONG, THANHPHO, TINH, ZIPCODE) VALUES
('ADDR001', 'KH001', N'123 Đường Trường Chinh', N'TP.HCM', N'TP.HCM', '700000'),
('ADDR002', 'KH002', N'456 Đường Lê Trọng Tấn', N'TP.HCM', N'TP.HCM', '700001');

-- CART (CARTID INT identity, KHACHHANGID NCHAR(10), MANV NCHAR(10))
INSERT INTO CART (KHACHHANGID, MANV, NGAYTAO, TRANGTHAI) VALUES
('KH001', NULL, GETDATE(), N'Chưa thanh toán'),
('KH002', NULL, GETDATE(), N'Chưa thanh toán'),
(NULL, 'NV002', GETDATE(), N'Chưa thanh toán'); -- ví dụ nhân viên tạo giỏ hộ

-- CARTDETAIL (một ví dụ cho KH001)
-- Lấy CartID = SCOPE_IDENTITY không khả dụng ở đây; giả sử CartID 1,2,3 tương ứng
INSERT INTO CARTDETAIL (CARTID, SANPHAMID, SOLUONG) VALUES
(1, 'SP003', 1),
(1, 'SP005', 2),
(2, 'SP009', 1),
(3, 'SP020', 1);

-- ORDERS (mẫu)
INSERT INTO ORDERS (ORDERID, KHACHHANGID, DIACHIID, NGAYDAT, TONGTIEN, TRANGTHAI, GHICHU, MANV_XULY) VALUES
('OR001', 'KH001', 'ADDR001', GETDATE(), 625000.00, N'Đang xử lý', N'Giao nhanh', 'NV001'),
('OR002', 'KH002', 'ADDR002', GETDATE(), 150000.00, N'Hoàn tất', N'Giao tiêu chuẩn', NULL);

-- ORDERDETAIL (mẫu)
INSERT INTO ORDERDETAIL (ORDERID, SANPHAMID, SOLUONG, DONGIA) VALUES
('OR001', 'SP005', 1, 250000.00),
('OR001', 'SP003', 1, 175000.00),
('OR002', 'SP025', 1, 150000.00);

-- PAYMENT (mẫu)
INSERT INTO PAYMENT (PAYMENTID, ORDERID, PHUONGTHUCTT, TRANGTHAITT, NGAYTT) VALUES
('PAY001', 'OR002', N'Chuyển khoản', N'Đã thanh toán', GETDATE());

-- ============================
-- 1. Khách hàng & địa chỉ
-- ============================
SELECT * FROM CUSTOMER;
SELECT * FROM ADDRESS;

-- ============================
-- 2. Danh mục & sản phẩm
-- ============================
SELECT * FROM CATEGORY;
SELECT * FROM PRODUCT;
SELECT * FROM PRODUCT_SIZE;
SELECT * FROM PRODUCT_COLOR;
SELECT * FROM PRODUCT_IMAGE;

-- ============================
-- 3. Nhân viên
-- ============================
SELECT * FROM STAFF;

-- ============================
-- 4. Giỏ hàng & chi tiết giỏ hàng
-- ============================
SELECT * FROM CART;
SELECT * FROM CARTDETAIL;

-- ============================
-- 5. Đơn hàng & chi tiết đơn hàng
-- ============================
SELECT * FROM ORDERS;
SELECT * FROM ORDERDETAIL;

-- ============================
-- 6. Thanh toán
-- ============================
SELECT * FROM PAYMENT;

-- ============================
-- CHƯƠNG 2 CÀI ĐẶT YÊU CẦU XỬ LÝ 
-- ============================

-- ============================
-- QUẢN LÝ KHÁCH HÀNG VÀ GIỎ HÀNG
-- ============================

--1.Procedure Thêm khách hàng mới và tự tạo địa chỉ mặc định, có kiểm tra trùng Email và SDT

CREATE PROCEDURE SP_THEMKHACHHANGDIACHI
    @KHACHHANGID NCHAR(10),
    @HOTEN NVARCHAR(100),
    @NGAYSINH DATE,
    @EMAIL NVARCHAR(100),
    @PASSWORD NVARCHAR(60),
    @DIENTHOAI VARCHAR(10)
AS
BEGIN
    BEGIN TRY
        BEGIN TRANSACTION;

        -- Kiểm tra email hoặc số điện thoại trùng
        IF EXISTS (SELECT 1 FROM CUSTOMER WHERE EMAIL = @EMAIL OR DIENTHOAI = @DIENTHOAI)
        BEGIN
            RAISERROR (N'Email hoặc số điện thoại đã tồn tại!', 16, 1);
            ROLLBACK TRANSACTION;
            RETURN;
        END;

        -- Thêm khách hàng mới
        INSERT INTO CUSTOMER (KHACHHANGID, HOTEN, NGAYSINH, EMAIL, PASSWORD, DIENTHOAI)
        VALUES (@KHACHHANGID, @HOTEN, @NGAYSINH, @EMAIL, @PASSWORD, @DIENTHOAI);

        -- Thêm địa chỉ mặc định
        DECLARE @DIACHIID NCHAR(10) = LEFT(CONVERT(NVARCHAR(36), NEWID()), 10);
        INSERT INTO ADDRESS (DIACHIID, KHACHHANGID, DUONG, THANHPHO, TINH, ZIPCODE)
        VALUES (@DIACHIID, @KHACHHANGID, N'Chưa cập nhật', N'Chưa cập nhật', N'Chưa cập nhật', '000000');

        COMMIT TRANSACTION;
        PRINT N'Thêm khách hàng và địa chỉ mặc định thành công!';
    END TRY
    BEGIN CATCH
        ROLLBACK TRANSACTION;
        PRINT N'Lỗi khi thêm khách hàng!';
    END CATCH;
END;
GO


--2.Procedure Cho phép khách hàng đổi thông tin cá nhân, có kiểm tra lỗi trùng Email

CREATE PROCEDURE SP_CAPNHATTHONGTIN_KHACHHANG
    @KHACHHANGID NCHAR(10),
    @HOTEN NVARCHAR(100),
    @NGAYSINH DATE,
    @EMAIL NVARCHAR(100),
    @DIENTHOAI VARCHAR(10)
AS
BEGIN
    BEGIN TRY
        BEGIN TRANSACTION;

        -- Kiểm tra trùng Email
        IF EXISTS (SELECT 1 FROM CUSTOMER WHERE EMAIL = @EMAIL AND KHACHHANGID <> @KHACHHANGID)
        BEGIN
            RAISERROR (N'Email đã được sử dụng bởi khách hàng khác!', 16, 1);
            ROLLBACK TRANSACTION;
            RETURN;
        END;

        UPDATE CUSTOMER
        SET HOTEN = @HOTEN,
            NGAYSINH = @NGAYSINH,
            EMAIL = @EMAIL,
            DIENTHOAI = @DIENTHOAI
        WHERE KHACHHANGID = @KHACHHANGID;

        COMMIT TRANSACTION;
        PRINT N'Cập nhật thông tin khách hàng thành công!';
    END TRY
    BEGIN CATCH
        ROLLBACK TRANSACTION;
        PRINT N'Lỗi khi cập nhật thông tin khách hàng!';
    END CATCH;
END;
GO

--KIỂM TRA DỮ LIỆU 
SELECT * FROM CUSTOMER WHERE KHACHHANGID = 'KH001';

EXEC SP_CAPNHATTHONGTIN_KHACHHANG 
    @KHACHHANGID = 'KH001',
    @HOTEN = N'Nguyễn Văn A',
    @NGAYSINH = '1990-05-10',
    @EMAIL = 'nguyenvana@gmail.com',
    @DIENTHOAI = '0909999999';



--4.Function Trả về danh sách đơn hàng + tổng tiền + trạng thái 

CREATE FUNCTION FN_DANHSACHDONHANG_KH (@KHACHHANGID NCHAR(10))
RETURNS TABLE
AS
RETURN
(
    SELECT 
        O.ORDERID,
        O.NGAYDAT,
        O.TONGTIEN,
        O.TRANGTHAI,
        COUNT(OD.SANPHAMID) AS SOSP
    FROM ORDERS O
    JOIN ORDERDETAIL OD ON O.ORDERID = OD.ORDERID
    WHERE O.KHACHHANGID = @KHACHHANGID
    GROUP BY O.ORDERID, O.NGAYDAT, O.TONGTIEN, O.TRANGTHAI
);
GO

--5.Cursor Duyệt từng khách hàng, in ra tổng số đơn hàng mỗi người.
CREATE PROCEDURE SP_THONGKEDONHANGTHEOKHACHHANG
AS
BEGIN
    DECLARE @KHID NCHAR(10), @TEN NVARCHAR(100), @SoDH INT;

    DECLARE cur CURSOR FOR
        SELECT KHACHHANGID, HOTEN FROM CUSTOMER;

    OPEN cur;
    FETCH NEXT FROM cur INTO @KHID, @TEN;

    WHILE @@FETCH_STATUS = 0
    BEGIN
        SELECT @SoDH = COUNT(*) FROM ORDERS WHERE KHACHHANGID = @KHID;
        PRINT N'Khách hàng: ' + @TEN + N' có ' + CAST(@SoDH AS NVARCHAR) + N' đơn hàng.';
        FETCH NEXT FROM cur INTO @KHID, @TEN;
    END;

    CLOSE cur;
    DEALLOCATE cur;
END;
GO


-- ============================
-- QUẢN LÝ SẢN PHẨM VÀ GIỎ HÀNG
-- ============================

--6.Procedure Thêm sản phẩm kèm size, màu, kiểm tra tồn tại CATEGORY.
CREATE PROCEDURE SP_THEMSANPHAMMOI
    @SANPHAMID NCHAR(10),
    @TENSANPHAM NVARCHAR(100),
    @DANHMUCID NCHAR(10),
    @GIA DECIMAL(18,2),
    @SIZE NVARCHAR(10),
    @MAUSAC NVARCHAR(50),
    @SOLUONGTONKHO INT
AS
BEGIN
    BEGIN TRY
        BEGIN TRANSACTION;

        -- Kiểm tra danh mục tồn tại
        IF NOT EXISTS (SELECT 1 FROM CATEGORY WHERE DANHMUCID = @DANHMUCID)
        BEGIN
            RAISERROR (N'Danh mục không tồn tại!', 16, 1);
            ROLLBACK TRANSACTION;
            RETURN;
        END;

        -- Kiểm tra sản phẩm đã tồn tại chưa
        IF EXISTS (SELECT 1 FROM PRODUCT WHERE SANPHAMID = @SANPHAMID)
        BEGIN
            RAISERROR (N'Mã sản phẩm đã tồn tại!', 16, 1);
            ROLLBACK TRANSACTION;
            RETURN;
        END;

        -- Bước 1: Thêm vào bảng PRODUCT
        INSERT INTO PRODUCT (SANPHAMID, TENSANPHAM, DANHMUCID, GIA, SOLUONGTONKHO)
        VALUES (@SANPHAMID, @TENSANPHAM, @DANHMUCID, @GIA, @SOLUONGTONKHO);

        -- Bước 2: Thêm size vào PRODUCT_SIZE
        INSERT INTO PRODUCT_SIZE (SANPHAMID, SIZE)
        VALUES (@SANPHAMID, @SIZE);

        -- Bước 3: Thêm màu vào PRODUCT_COLOR
        INSERT INTO PRODUCT_COLOR (SANPHAMID, MAUSAC)
        VALUES (@SANPHAMID, @MAUSAC);

        COMMIT TRANSACTION;
        PRINT N'Thêm sản phẩm mới thành công!';
    END TRY
    BEGIN CATCH
        ROLLBACK TRANSACTION;
        PRINT N'Lỗi khi thêm sản phẩm mới!';
    END CATCH;
END;
GO


--7.Trigger Khi thêm ORDERDETAIL, kiểm tra tồn kho đủ không. Nếu không đủ → rollback.

CREATE TRIGGER TR_KIEMTRATONKHO
ON ORDERDETAIL
INSTEAD OF INSERT
AS
BEGIN
    IF EXISTS (
        SELECT 1
        FROM INSERTED I
        JOIN PRODUCT P ON I.SANPHAMID = P.SANPHAMID
        WHERE I.SOLUONG > P.SOLUONGTONKHO
    )
    BEGIN
        RAISERROR (N'Số lượng đặt vượt quá tồn kho!', 16, 1);
        ROLLBACK TRANSACTION;
        RETURN;
    END;

    INSERT INTO ORDERDETAIL (ORDERID, SANPHAMID, SOLUONG, DONGIA)
    SELECT ORDERID, SANPHAMID, SOLUONG, DONGIA
    FROM INSERTED;
END;
GO


--8.Function Tính giá trung bình của các sản phẩm trong danh mục
CREATE FUNCTION FN_GIATRUNGBINHSANPHAMDANHMUC(@DANHMUCID NCHAR(10))
RETURNS DECIMAL(18,2)
AS
BEGIN
    DECLARE @GIA DECIMAL(18,2);
    SELECT @GIA = AVG(GIA) FROM PRODUCT WHERE DANHMUCID = @DANHMUCID;
    RETURN ISNULL(@GIA, 0);
END;
GO

--9.Procedure Sau khi đơn hàng được tạo, trừ số lượng tồn trong kho.
CREATE PROCEDURE SP_CAPNHATTONKHOSAUDATHANG
    @ORDERID NCHAR(10)
AS
BEGIN
    UPDATE P
    SET P.SOLUONGTONKHO = P.SOLUONGTONKHO - OD.SOLUONG
    FROM PRODUCT P
    JOIN ORDERDETAIL OD ON P.SANPHAMID = OD.SANPHAMID
    WHERE OD.ORDERID = @ORDERID;
END;
GO


--10.Trigger Cập nhật tổng tiền đơn hàng
CREATE TRIGGER TR_CAPNHAT_TONGTIEN_ORDERS
ON ORDERDETAIL
AFTER INSERT, DELETE, UPDATE
AS
BEGIN
    SET NOCOUNT ON;

    -- Khai báo bảng tạm để chứa các ORDERID bị ảnh hưởng
    DECLARE @OrderIDs TABLE (ORDERID NCHAR(10));

    -- Lấy tất cả ORDERID bị ảnh hưởng từ INSERTED và DELETED
    INSERT INTO @OrderIDs (ORDERID)
    SELECT ORDERID FROM INSERTED
    UNION
    SELECT ORDERID FROM DELETED;

    -- Cập nhật TONGTIEN trong bảng ORDERS
    UPDATE O
    SET O.TONGTIEN = ISNULL(
                        (
                            SELECT SUM(OD.SOLUONG * OD.DONGIA)
                            FROM ORDERDETAIL OD
                            WHERE OD.ORDERID = O.ORDERID
                        ), 0)
    FROM ORDERS O
    JOIN @OrderIDs A ON O.ORDERID = A.ORDERID;
END;
GO

--11. Cursor Cập nhật trạng thái sản phẩm theo tồn kho
DECLARE @MASP NCHAR(10), @TEN NVARCHAR(200), @TON INT;

DECLARE CUR_TONKHO CURSOR FOR
SELECT SANPHAMID, TENSANPHAM, SOLUONGTONKHO FROM PRODUCT;

OPEN CUR_TONKHO;
FETCH NEXT FROM CUR_TONKHO INTO @MASP, @TEN, @TON;

WHILE @@FETCH_STATUS = 0
BEGIN
    IF @TON = 0
        PRINT N'Sản phẩm ' + @TEN + N' (Mã ' + @MASP + N') đã hết hàng.';
    ELSE IF @TON < 10
        PRINT N'Sản phẩm ' + @TEN + N' (Mã ' + @MASP + N') sắp hết hàng.';
    ELSE
        PRINT N'Sản phẩm ' + @TEN + N' (Mã ' + @MASP + N') còn hàng ổn định.';
    FETCH NEXT FROM CUR_TONKHO INTO @MASP, @TEN, @TON;
END;

CLOSE CUR_TONKHO;
DEALLOCATE CUR_TONKHO;


-- ============================
-- QUẢN LÝ ĐƠN HÀNG VÀ THANH TOÁN
-- ============================

--12.Procedure Lấy giỏ hàng của KH → tạo đơn → ghi chi tiết → xoá giỏ.
CREATE PROCEDURE SP_TAODONHANGTUGIOHANG
    @OrderID NCHAR(10),
    @CartID INT, -- Sửa kiểu dữ liệu của @CartID thành INT cho phù hợp với định nghĩa bảng CART
    @DiaChiID NCHAR(10)
AS
BEGIN
    -- Kiểm tra sự tồn tại của CartID và DiaChiID
    IF NOT EXISTS (SELECT 1 FROM CART WHERE CARTID = @CartID)
    BEGIN
        RAISERROR (N'Mã giỏ hàng không tồn tại.', 16, 1);
        RETURN;
    END

    IF NOT EXISTS (SELECT 1 FROM ADDRESS WHERE DIACHIID = @DiaChiID)
    BEGIN
        RAISERROR (N'Mã địa chỉ không tồn tại.', 16, 1);
        RETURN;
    END

    -- Kiểm tra OrderID đã tồn tại chưa
    IF EXISTS (SELECT 1 FROM ORDERS WHERE ORDERID = @OrderID)
    BEGIN
        RAISERROR (N'Mã đơn hàng đã tồn tại.', 16, 1);
        RETURN;
    END

    BEGIN TRY
        BEGIN TRANSACTION;

        DECLARE @KhachHangID NCHAR(10);
        DECLARE @TongTien DECIMAL(18,2);

        -- Lấy KhachHangID từ CART
        SELECT @KhachHangID = KHACHHANGID FROM CART WHERE CARTID = @CartID;

        -- Tính Tổng Tiền (dùng GIA - giá đã giảm)
        SELECT @TongTien = SUM(CD.SOLUONG * P.GIA)
        FROM CARTDETAIL CD
        JOIN PRODUCT P ON CD.SANPHAMID = P.SANPHAMID
        WHERE CD.CARTID = @CartID;

        -- THÊM DỮ LIỆU VÀO ORDERS
        INSERT INTO ORDERS (ORDERID, KHACHHANGID, DIACHIID, NGAYDAT, TONGTIEN, TRANGTHAI)
        VALUES (@OrderID, @KhachHangID, @DiaChiID, GETDATE(), ISNULL(@TongTien, 0), N'Chờ xác nhận');

        -- THÊM DỮ LIỆU VÀO ORDERDETAIL
        INSERT INTO ORDERDETAIL (ORDERID, SANPHAMID, SOLUONG, DONGIA)
        SELECT @OrderID, CD.SANPHAMID, CD.SOLUONG, P.GIA -- SỬA LỖI: Chỉ định rõ CD.SANPHAMID và CD.SOLUONG
        FROM CARTDETAIL CD
        JOIN PRODUCT P ON CD.SANPHAMID = P.SANPHAMID
        WHERE CARTID = @CartID;

        -- XÓA CHI TIẾT GIỎ HÀNG
        DELETE FROM CARTDETAIL WHERE CARTID = @CartID;
        
        -- Cập nhật trạng thái giỏ hàng (Tùy chọn)
        -- UPDATE CART SET TRANGTHAI = N'Đã đặt hàng' WHERE CARTID = @CartID;

        -- COMMIT TRANSACTION
        COMMIT TRANSACTION;
        PRINT N'Tạo đơn hàng thành công. Đơn hàng ID: ' + @OrderID;
    END TRY
    BEGIN CATCH
        IF @@TRANCOUNT > 0
            ROLLBACK TRANSACTION;
        -- Báo lỗi chi tiết
        DECLARE @ErrorMessage NVARCHAR(4000) = ERROR_MESSAGE();
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();
        DECLARE @ErrorState INT = ERROR_STATE();
        
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);
    END CATCH;
END;
GO

--13.Trigger Khi bảng PAYMENT thêm mới và trạng thái là "Đã thanh toán", thì ORDERS đổi sang “Đã giao”
CREATE TRIGGER TR_CAPNHATTRANGTHAISAUTHANHTOAN
ON PAYMENT
AFTER INSERT
AS
BEGIN
    UPDATE O
    SET TRANGTHAI = N'ĐÃ GIAO HÀNG'
    FROM ORDERS O
    JOIN INSERTED I ON O.ORDERID = I.ORDERID
    WHERE I.TRANGTHAITT = N'ĐÃ THANH TOÁN';
END;
GO

--14.Function Tính tổng tiền 1 đơn từ ORDERDETAIL.
CREATE FUNCTION FN_TONGTIENDONHANG(@ORDERID NCHAR(10))
RETURNS DECIMAL(18,2)
AS
BEGIN
    DECLARE @TONG DECIMAL(18,2);
    SELECT @TONG = SUM(SOLUONG * DONGIA) FROM ORDERDETAIL WHERE ORDERID = @ORDERID;
    RETURN ISNULL(@TONG, 0);
END;
GO


--15.Procedure Tổng hợp doanh thu mỗi tháng của năm
CREATE PROCEDURE SP_THONGKEDOANHTHUTHEOTHANG
    @NAM INT
AS
BEGIN
    SELECT 
        MONTH(NGAYDAT) AS THANG,
        SUM(TONGTIEN) AS DOANHTHU
    FROM ORDERS
    WHERE YEAR(NGAYDAT) = @NAM AND TRANGTHAI = N'ĐÃ GIAO HÀNG'
    GROUP BY MONTH(NGAYDAT)
    ORDER BY THANG;
END;
GO



--16.Transaction Khi khách hủy đơn, rollback tiền + cập nhật tồn kho.

CREATE PROCEDURE SP_HUYDONHANG
    @ORDERID NCHAR(10)
AS
BEGIN
    -- Kiểm tra OrderID có tồn tại không
    IF NOT EXISTS (SELECT 1 FROM ORDERS WHERE ORDERID = @ORDERID)
    BEGIN
        RAISERROR (N'Mã đơn hàng không tồn tại. Vui lòng kiểm tra lại.', 16, 1);
        RETURN;
    END

    -- Bắt đầu Transaction
    BEGIN TRY
        BEGIN TRANSACTION;

        -- 1. KIỂM TRA TRẠNG THÁI HIỆN TẠI
        -- Chỉ cho phép hủy nếu trạng thái chưa phải là 'Hoàn tất' (đã giao) hoặc 'ĐÃ HỦY'
        IF EXISTS (SELECT 1 FROM ORDERS WHERE ORDERID = @ORDERID 
                   AND TRANGTHAI IN (N'Hoàn tất', N'ĐÃ GIAO HÀNG', N'ĐÃ HỦY'))
        BEGIN
            RAISERROR (N'Không thể hủy đơn hàng này do đã chuyển sang trạng thái đã hoàn tất hoặc đã hủy.', 16, 1);
            -- Lỗi nghiệp vụ, cần ROLLBACK
            ROLLBACK TRANSACTION;
            RETURN;
        END

        -- 2. HOÀN LẠI TỒN KHO (Tăng số lượng tồn kho lên)
        UPDATE P
        SET P.SOLUONGTONKHO = P.SOLUONGTONKHO + OD.SOLUONG
        FROM PRODUCT P
        JOIN ORDERDETAIL OD ON P.SANPHAMID = OD.SANPHAMID
        WHERE OD.ORDERID = @ORDERID;

        -- 3. CẬP NHẬT TRẠNG THÁI ĐƠN HÀNG
        UPDATE ORDERS 
        SET TRANGTHAI = N'ĐÃ HỦY',
            MANV_XULY = NULL 
        WHERE ORDERID = @ORDERID;

        -- COMMIT TRANSACTION nếu tất cả các bước trên thành công
        COMMIT TRANSACTION;
        PRINT N'Đơn hàng ID: ' + @ORDERID + N' đã được hủy thành công và tồn kho đã được hoàn lại.';
    END TRY
    BEGIN CATCH
        -- ROLLBACK TRANSACTION nếu có bất kỳ lỗi nào xảy ra
        IF @@TRANCOUNT > 0
            ROLLBACK TRANSACTION;
        
        -- Báo lỗi chi tiết
        DECLARE @ErrorMessage NVARCHAR(4000) = ERROR_MESSAGE();
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();
        DECLARE @ErrorState INT = ERROR_STATE();
        
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState);
    END CATCH;
END;
GO
-- ============================
-- CHƯƠNG 3 QUẢN TRỊ HỆ THỐNG
-- ============================


-- 1. Login cho Quản lý (Application Admin)
CREATE LOGIN Admin_Login WITH PASSWORD = N'Admin123', CHECK_POLICY = ON;
GO

-- 2. Login cho Nhân viên (Application Staff)
CREATE LOGIN Staff_Login WITH PASSWORD = N'Staff123', CHECK_POLICY = ON;
GO

-- 3. Login cho Khách hàng (Application Customer)
CREATE LOGIN Customer_Login WITH PASSWORD = N'Customer123', CHECK_POLICY = ON;
GO


-- 1. Tạo Users trong Database từ các Logins
CREATE USER Admin_User FOR LOGIN Admin_Login;
CREATE USER Staff_User FOR LOGIN Staff_Login;
CREATE USER Customer_User FOR LOGIN Customer_Login;
GO

-- 2. Tạo các Database Roles (Nhóm quyền)
CREATE ROLE AdminRole;
CREATE ROLE StaffRole;
CREATE ROLE CustomerRole;
GO

-- 3. Gán Users vào các Roles tương ứng
ALTER ROLE AdminRole ADD MEMBER Admin_User;
ALTER ROLE StaffRole ADD MEMBER Staff_User;
ALTER ROLE CustomerRole ADD MEMBER Customer_User;
GO

----  A. Cấp quyền cho ADMIN 
-- Toàn quyền trên các bảng, thực thi tất cả SP/Function
GRANT SELECT, INSERT, UPDATE, DELETE ON SCHEMA :: dbo TO AdminRole;
GRANT EXECUTE TO AdminRole; 
GO

--  B. Cấp quyền cho STAFF ROLE (Bán hàng và xem thông tin)
-- SELECT trên các bảng cần thiết
GRANT SELECT ON PRODUCT TO StaffRole;
GRANT SELECT ON CUSTOMER TO StaffRole;
GRANT SELECT ON ORDERS TO StaffRole;
GRANT SELECT ON STAFF TO StaffRole;
-- Quyền thực thi các SP bán hàng
GRANT EXECUTE ON SP_TAODONHANGTUGIOHANG TO StaffRole;
GRANT EXECUTE ON SP_CAPNHATTONKHOSAUDATHANG TO StaffRole;
GO

--  C. Cấp quyền cho CUSTOMER 
-- Quyền trên các bảng mua sắm (chỉ INSERT/UPDATE/DELETE trên giỏ hàng)

-- Quyền trên các bảng mua sắm
GRANT SELECT ON PRODUCT TO CustomerRole;
GRANT SELECT ON CATEGORY TO CustomerRole;
GRANT SELECT, INSERT, UPDATE, DELETE ON CART TO CustomerRole;
GRANT SELECT, INSERT, UPDATE, DELETE ON CARTDETAIL TO CustomerRole;

-- Quyền thực thi các Stored Procedure 
GRANT EXECUTE ON SP_THEMKHACHHANGDIACHI TO CustomerRole;
GRANT EXECUTE ON SP_CAPNHATTHONGTIN_KHACHHANG TO CustomerRole;

-- SỬA LỖI: Sử dụng cú pháp GRANT VIEW DEFINITION ON OBJECT::
GRANT VIEW DEFINITION ON OBJECT::FN_DANHSACHDONHANG_KH TO CustomerRole; 
-- Đối với Table-Valued Function (TVF), bạn phải dùng GRANT SELECT
GRANT SELECT ON FN_DANHSACHDONHANG_KH TO CustomerRole;
GO


---KHÁNH KO CHẠY Này 
-- 1. Hủy quyền kết nối mặc định của Public
REVOKE CONNECT FROM [public];
GO
-- 2. Ngăn CustomerRole tạo các đối tượng mới
REVOKE CREATE TABLE TO CustomerRole;
REVOKE CREATE VIEW TO CustomerRole;
REVOKE CREATE FUNCTION TO CustomerRole;
GO
-- 3. Ngăn StaffRole tạo các đối tượng mới
REVOKE CREATE TABLE TO StaffRole;
REVOKE CREATE VIEW TO StaffRole;
REVOKE CREATE FUNCTION TO StaffRole;
GO




EXEC sp_configure 'show advanced options', 1;
RECONFIGURE;
EXEC sp_configure 'xp_cmdshell', 1;
RECONFIGURE;


-- Đặt Recovery Model sang FULL để sao lưu log
ALTER DATABASE FashionWeb SET RECOVERY FULL;
GO

PRINT '------------------------------------------------------------';
PRINT N' BẮT ĐẦU SAO LƯU CƠ SỞ DỮ LIỆU FashionWeb';
PRINT '------------------------------------------------------------';
PRINT N'Ngày giờ thực thi: ' + CONVERT(VARCHAR, GETDATE(), 120);
PRINT '';

------------------------------------------------------------
-- 1️ Thực hiện Full Backup vào Chủ nhật
------------------------------------------------------------
DECLARE @BackupFile NVARCHAR(400);

SET @BackupFile = 'D:\SQL Server Management Studio\SQL\HQTCSDL_DOAN\NHOM10_CSDL\Backup\FashionWeb_FULL_' 
                  + CONVERT(VARCHAR(8), GETDATE(), 112) + '_' 
                  + REPLACE(CONVERT(VARCHAR(8), GETDATE(), 108), ':', '') + '.bak';

BACKUP DATABASE FashionWeb
TO DISK = @BackupFile
WITH INIT,
     NAME = 'Full Backup FashionWeb',
     SKIP,
     STATS = 10;

------------------------------------------------------------
-- 12 Thực hiện  DIFFERENTIAL
------------------------------------------------------------
DECLARE @BackupFile NVARCHAR(400);

SET @BackupFile = 'D:\SQL Server Management Studio\SQL\HQTCSDL_DOAN\NHOM10_CSDL\Backup\FashionWeb_DIFF_' 
                  + CONVERT(VARCHAR(8), GETDATE(), 112) + '_' 
                  + REPLACE(CONVERT(VARCHAR(8), GETDATE(), 108), ':', '') + '.bak';

BACKUP DATABASE FashionWeb
TO DISK = @BackupFile
WITH DIFFERENTIAL,
     INIT,
     NAME = 'Differential Backup FashionWeb',
     SKIP,
     STATS = 10;


------------------------------------------------------------
-- 3️ Sao lưu Transaction Log (mọi ngày)
------------------------------------------------------------
DECLARE @BackupFile NVARCHAR(400);

PRINT N'--- Thực hiện Transaction Log Backup ---';

SET @BackupFile = 'D:\SQL Server Management Studio\SQL\HQTCSDL_DOAN\NHOM10_CSDL\Backup\FashionWeb_LOG_' 
                  + CONVERT(VARCHAR(8), GETDATE(), 112) + '_' 
                  + REPLACE(CONVERT(VARCHAR(8), GETDATE(), 108), ':', '') + '.trn';

BACKUP LOG FashionWeb
TO DISK = @BackupFile
WITH INIT,
     NAME = 'Transaction Log Backup FashionWeb',
     SKIP,
     STATS = 5;
GO

------------------------------------------------------------
-- 4️ Tự động xóa các file cũ hơn 7 ngày
------------------------------------------------------------
EXEC master.dbo.xp_cmdshell 
'forfiles /p "D:\SQL Server Management Studio\SQL\HQTCSDL_DOAN\NHOM10_CSDL\Backup\" /m *.bak /d -7 /c "cmd /c del @path"';

EXEC master.dbo.xp_cmdshell 
'forfiles /p "D:\SQL Server Management Studio\SQL\HQTCSDL_DOAN\NHOM10_CSDL\Backup\" /m *.trn /d -7 /c "cmd /c del @path"';

PRINT '';
PRINT N'--- Hoàn tất sao lưu cơ sở dữ liệu FashionWeb ---';
PRINT N'Thời gian kết thúc: ' + CONVERT(VARCHAR, GETDATE(), 120);

GO



-----------------------Bài sao lưu tự động của Khánh tham khảo (tham khảo thôi đừng chạy, này là không dùng agent mà dùng lệnh)-----------------------
EXEC sp_configure 'show advanced options', 1;
RECONFIGURE;
EXEC sp_configure 'xp_cmdshell', 1;
RECONFIGURE;
GO

--Job 1: FULL + DIFFERENTIAL + CLEANUP (chạy mỗi ngày 00:00)
--Nếu chủ nhật thì Full
--Các ngày còn lại Differential
--Dọn file cũ hơn 7 ngày
USE master;
GO
EXEC sp_add_job @job_name = N'FashionWeb_Backup_Daily';

EXEC sp_add_jobstep 
    @job_name = N'FashionWeb_Backup_Daily',
    @step_name = N'Full or Differential Backup + Cleanup',
    @subsystem = N'TSQL',
    @command = N'
------------------------------------------------------------
-- Đặt Recovery Model sang FULL
------------------------------------------------------------
ALTER DATABASE FashionWeb SET RECOVERY FULL;

PRINT N''------------------------------------------------------------'';
PRINT N'' BẮT ĐẦU SAO LƯU CƠ SỞ DỮ LIỆU FashionWeb'';
PRINT N''------------------------------------------------------------'';
PRINT N''Ngày giờ thực thi: '' + CONVERT(VARCHAR, GETDATE(), 120);
PRINT '''';

------------------------------------------------------------
-- 1️ Kiểm tra nếu là Chủ nhật thì sao lưu FULL
------------------------------------------------------------
IF DATENAME(WEEKDAY, GETDATE()) = ''Sunday''
BEGIN
    PRINT N''--- Thực hiện FULL BACKUP ---'';
    DECLARE @BackupFile NVARCHAR(400);
    SET @BackupFile = ''D:\SQL Server Management Studio\SQL\HQTCSDL_DOAN\NHOM10_CSDL\Backup\FashionWeb_FULL_'' 
                      + CONVERT(VARCHAR(8), GETDATE(), 112) + ''_'' 
                      + REPLACE(CONVERT(VARCHAR(8), GETDATE(), 108), '':'', '''') + ''.bak'';
    BACKUP DATABASE FashionWeb
    TO DISK = @BackupFile
    WITH INIT, NAME = ''Full Backup FashionWeb'', SKIP, STATS = 10;
END
ELSE
BEGIN
------------------------------------------------------------
-- 2️ Nếu không phải Chủ nhật thì sao lưu DIFFERENTIAL
------------------------------------------------------------
    PRINT N''--- Thực hiện DIFFERENTIAL BACKUP ---'';
    DECLARE @BackupFile NVARCHAR(400);
    SET @BackupFile = ''D:\SQL Server Management Studio\SQL\HQTCSDL_DOAN\NHOM10_CSDL\Backup\FashionWeb_DIFF_'' 
                      + CONVERT(VARCHAR(8), GETDATE(), 112) + ''_'' 
                      + REPLACE(CONVERT(VARCHAR(8), GETDATE(), 108), '':'', '''') + ''.bak'';
    BACKUP DATABASE FashionWeb
    TO DISK = @BackupFile
    WITH DIFFERENTIAL, INIT, NAME = ''Differential Backup FashionWeb'', SKIP, STATS = 10;
END

------------------------------------------------------------
-- 3️ Xóa file backup cũ hơn 7 ngày
------------------------------------------------------------
EXEC master.dbo.xp_cmdshell 
''forfiles /p "D:\SQL Server Management Studio\SQL\HQTCSDL_DOAN\NHOM10_CSDL\Backup\" /m *.bak /d -7 /c "cmd /c del @path"'';

EXEC master.dbo.xp_cmdshell 
''forfiles /p "D:\SQL Server Management Studio\SQL\HQTCSDL_DOAN\NHOM10_CSDL\Backup\" /m *.trn /d -7 /c "cmd /c del @path"'';

PRINT N''''--- Hoàn tất sao lưu cơ sở dữ liệu FashionWeb ---'''';
PRINT N''Thời gian kết thúc: '' + CONVERT(VARCHAR, GETDATE(), 120);
';

EXEC sp_add_schedule 
    @schedule_name = N'FashionWeb_Backup_Daily_Schedule',
    @freq_type = 4,                -- Hàng ngày
    @freq_interval = 1,            -- Mỗi ngày
    @active_start_time = 000000;   -- 00:00:00 (nửa đêm)

EXEC sp_attach_schedule 
    @job_name = N'FashionWeb_Backup_Daily',
    @schedule_name = N'FashionWeb_Backup_Daily_Schedule';

EXEC sp_add_jobserver @job_name = N'FashionWeb_Backup_Daily';
GO

--Job 2: Log backup (chạy mỗi 2 tiếng)
USE master;
GO
EXEC sp_add_job @job_name = N'FashionWeb_LogBackup_TwoHourly';

EXEC sp_add_jobstep 
    @job_name = N'FashionWeb_LogBackup_TwoHourly',
    @step_name = N'Log Backup Step',
    @subsystem = N'TSQL',
    @command = N'
PRINT N''--- Thực hiện Transaction Log Backup ---'';
DECLARE @BackupFile NVARCHAR(400);
SET @BackupFile = ''D:\SQL Server Management Studio\SQL\HQTCSDL_DOAN\NHOM10_CSDL\Backup\FashionWeb_LOG_'' 
                  + CONVERT(VARCHAR(8), GETDATE(), 112) + ''_'' 
                  + REPLACE(CONVERT(VARCHAR(8), GETDATE(), 108), '':'', '''') + ''.trn'';
BACKUP LOG FashionWeb
TO DISK = @BackupFile
WITH INIT, NAME = ''Transaction Log Backup FashionWeb'', SKIP, STATS = 5;
';

EXEC sp_add_schedule 
    @schedule_name = N'FashionWeb_LogBackup_Every2Hours',
    @freq_type = 4,               -- Hàng ngày
    @freq_interval = 1,           -- Mỗi ngày
    @freq_subday_type = 8,        -- Theo giờ
    @freq_subday_interval = 2,    -- Mỗi 2 giờ
    @active_start_time = 000000;  -- Bắt đầu từ 00:00

EXEC sp_attach_schedule 
    @job_name = N'FashionWeb_LogBackup_TwoHourly',
    @schedule_name = N'FashionWeb_LogBackup_Every2Hours';

EXEC sp_add_jobserver @job_name = N'FashionWeb_LogBackup_TwoHourly';
GO

--Job 3: tự động xóa các file cũ hơn 7 ngày
USE msdb;
GO

EXEC sp_add_job
    @job_name = N'FashionWeb - Cleanup Backup Files',
    @description = N'Tự động xóa các file backup cũ hơn 7 ngày.';

EXEC sp_add_jobstep
    @job_name = N'FashionWeb - Cleanup Backup Files',
    @step_name = N'Delete old backup files',
    @subsystem = N'TSQL',
    @database_name = N'master',
    @command = N'
    EXEC master.dbo.xp_cmdshell ''forfiles /p "D:\SQL Server Management Studio\SQL\HQTCSDL_DOAN\NHOM10_CSDL\Backup\" /m *.bak /d -7 /c "cmd /c del @path"'';
    EXEC master.dbo.xp_cmdshell ''forfiles /p "D:\SQL Server Management Studio\SQL\HQTCSDL_DOAN\NHOM10_CSDL\Backup\" /m *.trn /d -7 /c "cmd /c del @path"'';
    ';

EXEC sp_add_schedule
    @schedule_name = N'Cleanup_Daily',
    @freq_type = 4,          -- Daily
    @freq_interval = 1,
    @active_start_time = 010000;  -- 01:00 sáng

EXEC sp_attach_schedule
    @job_name = N'FashionWeb - Cleanup Backup Files',
    @schedule_name = N'Cleanup_Daily';

EXEC sp_add_jobserver
    @job_name = N'FashionWeb - Cleanup Backup Files';
GO
------------------------------------------------------------------------------------------------------------------------------------------------------